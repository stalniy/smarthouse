- id: sync_temp_over_ebus
  alias: –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä –Ω–∞–≥—Ä—ñ–≤—É —á–µ—Ä–µ–∑ Ebus
  trigger:
    - platform: time_pattern
      minutes: "/5"
    - platform: state
      entity_id: 
        - switch.ebusd_bai_heatingswitch_onoff
        - switch.ebusd_bai_hwcswitch_onoff
        - input_number.main_heater_storage_temp_desired 
  action:
    - service: python_script.heating_ebus_sync
  mode: single

- id: notify_about_heating
  alias: '–ù–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –ø—Ä–æ –≤–∫–ª—é—á–µ–Ω–Ω—è –Ω–∞–≥—Ä—ñ–≤—É'
  trigger:
    - platform: state
      entity_id: binary_sensor.ebusd_bai_flame
      for: 00:01:00
  action:
  - service: notify.telegram_serhii
    data:
      message: |
        *–†–µ–∂–∏–º –∫–æ—Ç–ª–∞:* {{ states('sensor.ebusd_bai_state') }}
        ‚ö° *–ü—ñ–¥—ñ–≥—Ä—ñ–≤* {{ states('binary_sensor.ebusd_bai_flame') }}, –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å {{ states('sensor.main_heater_current_power') }}
        ‚ô® *–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞* {{ states('sensor.ebusd_bai_flowtemp_temp') }} / {{ states('sensor.ebusd_bai_flowtempdesired_temp') }}
        Ô∏èüö∞ *–ì–í–°* {{ states('sensor.ebusd_bai_storagetemp_temp') }} / {{ states('sensor.ebusd_bai_storagetempdesired_temp') }}
  mode: single

- id: heating_abnormal_water_pressure
  alias: "–ù–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –ø—Ä–æ –Ω–µ –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Ç–∏—Å–∫ –≤ –æ–ø–∞–ª–µ–Ω–Ω—ñ"
  trigger:
    - platform: numeric_state
      entity_id: sensor.ebusd_bai_waterpressure_press
      above: 2.2
    - platform: numeric_state
      entity_id: sensor.ebusd_bai_waterpressure_press
      below: 1.2
  action:
    - service: notify.telegram_serhii
      data:
        message: |
          –ö—Ä–∏—Ç–∏—á–Ω–∏–π —Ç–∏—Å–∫ —Ç–µ–ø–ª–æ–Ω–æ—Å—ñ—è: <b>{{ states('sensor.ebusd_bai_waterpressure_press') }}</b>
    - service: persistent_notification.create
      data:
        title: ‚ö† - Warning!
        message: "–ö—Ä–∏—Ç–∏—á–Ω–∏–π —Ç–∏—Å–∫ —Ç–µ–ø–ª–æ–Ω–æ—Å—ñ—è: <b>{{ states('sensor.ebusd_bai_waterpressure_press') }}</b>"
  mode: single

- id: save_last_heating_temperature
  alias: "–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏ –Ω–æ—Å—ñ—è –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è –∫–ª–∞–ø–∞–Ω–∞ –ì–í–°"
  trigger:
    - platform: state
      entity_id: sensor.ebusd_bai_positionvalveset
      from: Heating
  action:
    - service: input_number.set_value
      data:
        value: "{{ states('sensor.ebusd_bai_flowtemp_temp') | float }}"
      target:
        entity_id: input_number.heating_last_flowtemp
  mode: restart 